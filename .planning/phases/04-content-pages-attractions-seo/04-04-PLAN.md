---
phase: 04-content-pages-attractions-seo
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - nuxt.config.ts
  - app/app.vue
  - app/pages/index.vue
  - app/pages/zimmer/index.vue
  - app/pages/zimmer/[slug].vue
  - app/pages/familie.vue
  - app/pages/nachhaltigkeit.vue
  - app/pages/kontakt.vue
  - app/pages/aktivitaeten/index.vue
  - app/pages/aktivitaeten/wandern.vue
  - app/pages/aktivitaeten/radfahren.vue
  - app/pages/ausflugsziele/index.vue
  - app/pages/impressum.vue
  - app/pages/datenschutz.vue
  - app/pages/agb.vue
autonomous: true
gap_closure: true

must_haves:
  truths:
    - 'Prerendered HTML for homepage contains a JSON-LD script with @type BedAndBreakfast (not LocalBusiness or Organization)'
    - 'Prerendered HTML for any subpage with BreadcrumbNav contains a JSON-LD script with @type BreadcrumbList'
    - 'Every page meta title is max 60 characters with no duplicate Pension Volgenandt suffix'
    - 'Homepage has og:image, og:description, and hreflang=de link tag in prerendered HTML'
    - 'Room detail pages have og:image, og:description, and hreflang=de link tag in prerendered HTML'
    - 'robots.txt is generated and accessible after nuxt generate'
  artifacts:
    - path: 'app/app.vue'
      provides: 'BedAndBreakfast Schema.org identity via useSchemaOrg'
      contains: 'BedAndBreakfast'
    - path: 'nuxt.config.ts'
      provides: 'Cleaned identity config (no type/subtype), fixed titleTemplate behavior'
    - path: 'app/pages/index.vue'
      provides: 'Homepage with useSeoMeta (ogImage, ogDescription) and hreflang'
      contains: 'useSeoMeta'
    - path: 'app/pages/zimmer/[slug].vue'
      provides: 'Room detail page with useSeoMeta (ogImage, ogDescription) and hreflang'
      contains: 'useSeoMeta'
  key_links:
    - from: 'app/app.vue'
      to: '@unhead/schema-org'
      via: 'useSchemaOrg with @type BedAndBreakfast'
      pattern: 'BedAndBreakfast'
    - from: 'nuxt.config.ts'
      to: 'nuxt-seo-utils titleTemplate'
      via: 'site.name or seo.splash config'
      pattern: 'titleSeparator|titleTemplate'
    - from: 'app/pages/index.vue'
      to: 'og:image meta tag'
      via: 'useSeoMeta({ ogImage })'
      pattern: 'ogImage'
---

<objective>
Close two verification gaps from Phase 4: (1) Fix Schema.org BedAndBreakfast identity producing wrong @type and fix BreadcrumbList schema not appearing in SSG HTML; (2) Fix meta title duplication (all titles exceed 60 chars), add missing og:image/og:description/hreflang to homepage and room pages, and verify robots.txt accessibility.

Purpose: Without these fixes, Google Rich Results Test fails for BedAndBreakfast and BreadcrumbList schemas, and all page titles exceed the 60-character SEO limit. These are the final two gaps blocking Phase 4 completion.

Output: Correct Schema.org structured data, compliant meta titles, and complete OG/hreflang tags across all pages.
</objective>

<execution_context>
@C:\Users\bernt\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\bernt\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-content-pages-attractions-seo/04-VERIFICATION.md

Key current state:

- nuxt.config.ts has schemaOrg.identity with type:'LocalBusiness', subtype:'BedAndBreakfast' which produces @type:["Organization","LocalBusiness"] -- Google needs @type:"BedAndBreakfast"
- nuxt-schema-org v5.0.10 localBusinessResolver hardcodes @type:["Organization","LocalBusiness"]; there is NO bedAndBreakfast resolver; the subtype property is passed through as non-standard
- BreadcrumbNav.vue uses useBreadcrumbItems({schemaOrg:true}) but BreadcrumbList JSON-LD does not appear in prerendered HTML
- nuxt-seo-utils titleTemplate auto-appends " | Pension Volgenandt" via site.name; all page-level titles already end with "| Pension Volgenandt", causing duplication (62-76 chars)
- Content pages (familie, nachhaltigkeit, kontakt, aktivitaeten, ausflugsziele, wandern, radfahren) all use useSeoMeta with ogImage + useHead with hreflang -- these are the CORRECT pattern
- Homepage (index.vue) and room pages (zimmer/index.vue, zimmer/[slug].vue) only use useHead with no useSeoMeta, missing ogImage and hreflang
- Attraction seoTitle values in YAML files do NOT contain "| Pension Volgenandt" (e.g. "Baerenpark Worbis | Pension nahe Baerenpark") -- these are max 60 chars already and will NOT get duplication from titleTemplate since they don't contain the site name
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Schema.org BedAndBreakfast identity and BreadcrumbList emission</name>
  <files>
    nuxt.config.ts
    app/app.vue
  </files>
  <action>
**Problem 1: BedAndBreakfast @type**

The nuxt-schema-org v5 `localBusinessResolver` hardcodes `@type: ["Organization", "LocalBusiness"]`. The `subtype` property is not recognized -- it's passed through as a non-standard JSON-LD property. There is no `bedAndBreakfast` resolver in @unhead/schema-org. The identity config approach CANNOT produce `@type: "BedAndBreakfast"`.

**Fix:** Remove the `identity` block from `schemaOrg` in nuxt.config.ts entirely, and instead define the BedAndBreakfast Schema.org entity manually via `useSchemaOrg` in app/app.vue.

1. In `nuxt.config.ts`, remove the entire `schemaOrg` block (lines 33-63):

   ```typescript
   // DELETE this entire block:
   schemaOrg: {
     identity: {
       type: 'LocalBusiness',
       subtype: 'BedAndBreakfast',
       ...
     },
   },
   ```

2. In `app/app.vue`, add a `<script setup lang="ts">` block and define the BedAndBreakfast schema using `useSchemaOrg`:

   ```typescript
   <script setup lang="ts">
   useSchemaOrg([
     {
       '@type': 'BedAndBreakfast',
       '@id': 'https://www.pension-volgenandt.de/#identity',
       'name': 'Pension Volgenandt',
       'description': 'Familiaer gefuehrte Pension in Breitenbach, Eichsfeld. Ferienwohnungen und Zimmer mit Blick ins Gruene.',
       'url': 'https://www.pension-volgenandt.de',
       'logo': 'https://www.pension-volgenandt.de/img/logo.webp',
       'image': 'https://www.pension-volgenandt.de/img/hero/hero-poster.webp',
       'telephone': '+49 3605 542775',
       'email': 'kontakt@pension-volgenandt.de',
       'address': {
         '@type': 'PostalAddress',
         'streetAddress': 'Otto-Reuter-Strasse 28',
         'addressLocality': 'Leinefelde-Worbis OT Breitenbach',
         'postalCode': '37327',
         'addressRegion': 'Thueringen',
         'addressCountry': 'DE',
       },
       'geo': {
         '@type': 'GeoCoordinates',
         'latitude': 51.3747,
         'longitude': 10.2197,
       },
       'amenityFeature': [
         { '@type': 'LocationFeatureSpecification', 'name': 'WiFi', 'value': true },
         { '@type': 'LocationFeatureSpecification', 'name': 'Parking', 'value': true },
         { '@type': 'LocationFeatureSpecification', 'name': 'Breakfast', 'value': true },
       ],
       'petsAllowed': true,
       'priceRange': 'EUR 38-89',
       'checkinTime': '15:00',
       'checkoutTime': '10:00',
     },
   ])
   </script>
   ```

   IMPORTANT: Keep the existing `<template>` block in app.vue exactly as-is. Only add the `<script setup>` block before it.

**Problem 2: BreadcrumbList not in prerendered HTML**

The `useBreadcrumbItems({schemaOrg: true})` composable in BreadcrumbNav.vue should emit BreadcrumbList JSON-LD. If it does not appear in prerendered HTML, it may be because the schema is only client-side rendered. This is likely already working correctly since we are removing the identity config (which may have been conflicting). After removing the identity block and adding the manual useSchemaOrg call, rebuild and check if BreadcrumbList appears. If it still does not appear after the build:

- Check that nuxt-schema-org is NOT set to `reactive: true` (which makes it client-only). The default for SSR is `reactive: false` which renders server-side.
- The composable should work out of the box with SSG. The issue may have been that the identity config was interfering with schema emission ordering.

Do NOT modify BreadcrumbNav.vue -- it is correctly implemented. The fix is in the identity config removal.
</action>
<verify>
Run `pnpm build` (or `npx nuxi generate`) and then inspect the prerendered HTML:

1. Check BedAndBreakfast schema:

   ```bash
   grep -o '"@type"[^,]*' .output/public/index.html | head -10
   ```

   Expected: `"@type":"BedAndBreakfast"` (NOT `["Organization","LocalBusiness"]`)

2. Check BreadcrumbList schema on a subpage:

   ```bash
   grep -o 'BreadcrumbList' .output/public/familie/index.html
   ```

   Expected: `BreadcrumbList` appears at least once

3. Check no `subtype` property remains:
   ```bash
   grep 'subtype' .output/public/index.html
   ```
   Expected: no match
   </verify>
   <done>
   Prerendered homepage HTML contains `@type: "BedAndBreakfast"` in JSON-LD (not LocalBusiness). Prerendered subpage HTML contains `@type: "BreadcrumbList"` in JSON-LD. No non-standard `subtype` property in any schema output.
   </done>
   </task>

<task type="auto">
  <name>Task 2: Fix meta title duplication and add missing OG/hreflang tags</name>
  <files>
    app/pages/index.vue
    app/pages/zimmer/index.vue
    app/pages/zimmer/[slug].vue
    app/pages/familie.vue
    app/pages/nachhaltigkeit.vue
    app/pages/kontakt.vue
    app/pages/aktivitaeten/index.vue
    app/pages/aktivitaeten/wandern.vue
    app/pages/aktivitaeten/radfahren.vue
    app/pages/ausflugsziele/index.vue
    app/pages/impressum.vue
    app/pages/datenschutz.vue
    app/pages/agb.vue
  </files>
  <action>
**Problem: Title duplication**

nuxt-seo-utils auto-generates a `titleTemplate` from `site.name` that appends `" | Pension Volgenandt"` to every page title. All page-level titles already include `"| Pension Volgenandt"`, causing duplication like:

- "Familie & Kinder | Pension Volgenandt | Pension Volgenandt" (62 chars)
- "Ferienwohnung Emils Kuhwiese | Pension Volgenandt | Pension Volgenandt" (75 chars)

**Fix strategy:** Strip `" | Pension Volgenandt"` from all page-level title strings and let the titleTemplate add it once. This keeps titles under 60 chars. The titleTemplate behavior is automatic from `site.name` in nuxt.config.ts.

For the homepage (index.vue), use a special title without the separator since the site name IS the title. Use `titleTemplate: '%s'` override via `useHead` to prevent appending on the homepage only. The homepage title should be: `"Pension Volgenandt -- Ruhe finden im Eichsfeld"` (48 chars).

**Files to update (strip " | Pension Volgenandt" from title and ogTitle values):**

1. **app/pages/index.vue** -- Currently uses only `useHead`. Replace with:

   ```typescript
   useSeoMeta({
     title: 'Pension Volgenandt -- Ruhe finden im Eichsfeld',
     ogTitle: 'Pension Volgenandt -- Ruhe finden im Eichsfeld',
     description:
       'Familiaer gefuehrte Pension in Breitenbach, Eichsfeld. Ferienwohnungen und Zimmer mit Blick ins Gruene. Wandern, Burgen, Baerenpark in der Naehe.',
     ogDescription:
       'Familiaer gefuehrte Pension in Breitenbach, Eichsfeld. Ferienwohnungen und Zimmer mit Blick ins Gruene. Wandern, Burgen, Baerenpark in der Naehe.',
     ogImage: '/img/hero/hero-poster.webp',
     ogType: 'website',
   })
   useHead({
     titleTemplate: '%s',
     link: [
       { rel: 'canonical', href: 'https://www.pension-volgenandt.de/' },
       { rel: 'alternate', hreflang: 'de', href: 'https://www.pension-volgenandt.de/' },
     ],
   })
   ```

   Remove the old `useHead` block that only set title and meta description.

2. **app/pages/zimmer/index.vue** -- Currently uses only `useHead`. Replace with:

   ```typescript
   useSeoMeta({
     title: 'Zimmer & Ferienwohnungen',
     ogTitle: 'Zimmer & Ferienwohnungen | Pension Volgenandt',
     description:
       'Entdecken Sie unsere 7 gemuetlichen Zimmer und Ferienwohnungen in Breitenbach im Eichsfeld. Ab 38 EUR pro Nacht inkl. MwSt.',
     ogDescription:
       'Entdecken Sie unsere 7 gemuetlichen Zimmer und Ferienwohnungen in Breitenbach im Eichsfeld. Ab 38 EUR pro Nacht inkl. MwSt.',
     ogImage: '/img/rooms/emils-kuhwiese/hero.webp',
     ogType: 'website',
   })
   useHead({
     link: [
       { rel: 'canonical', href: 'https://www.pension-volgenandt.de/zimmer/' },
       { rel: 'alternate', hreflang: 'de', href: 'https://www.pension-volgenandt.de/zimmer/' },
     ],
   })
   ```

   Remove the old `useHead` block.

3. **app/pages/zimmer/[slug].vue** -- Currently uses only `useHead`. Replace with (after the room fetch and 404 guard, keeping the useSchemaOrg block):

   ```typescript
   useSeoMeta({
     title: room.value.name,
     ogTitle: `${room.value.name} | Pension Volgenandt`,
     description:
       room.value.shortDescription.length > 155
         ? `${room.value.shortDescription.slice(0, 152)}...`
         : room.value.shortDescription,
     ogDescription:
       room.value.shortDescription.length > 155
         ? `${room.value.shortDescription.slice(0, 152)}...`
         : room.value.shortDescription,
     ogImage: `https://www.pension-volgenandt.de${room.value.heroImage}`,
     ogType: 'website',
   })
   useHead({
     link: [
       { rel: 'canonical', href: `https://www.pension-volgenandt.de/zimmer/${room.value.slug}/` },
       {
         rel: 'alternate',
         hreflang: 'de',
         href: `https://www.pension-volgenandt.de/zimmer/${room.value.slug}/`,
       },
     ],
   })
   ```

   Remove the old `useHead` block (but keep useSchemaOrg).

4. **app/pages/familie.vue** -- Change `title:` from `'Familie & Kinder | Pension Volgenandt'` to `'Familie & Kinder'` (and ogTitle stays as `'Familie & Kinder | Pension Volgenandt'` for social). Count: "Familie & Kinder" = 17 chars -> with template: "Familie & Kinder | Pension Volgenandt" = 38 chars. OK.

5. **app/pages/nachhaltigkeit.vue** -- Change title from `'Nachhaltigkeit | Pension Volgenandt'` to `'Nachhaltigkeit'`.

6. **app/pages/kontakt.vue** -- Change title from `'Kontakt | Pension Volgenandt'` to `'Kontakt'`.

7. **app/pages/aktivitaeten/index.vue** -- Change title from `'Aktivitaeten im Eichsfeld | Pension Volgenandt'` to `'Aktivitaeten im Eichsfeld'`.

8. **app/pages/aktivitaeten/wandern.vue** -- Change title from whatever it currently has to strip "| Pension Volgenandt". Check current value and strip.

9. **app/pages/aktivitaeten/radfahren.vue** -- Same as wandern.

10. **app/pages/ausflugsziele/index.vue** -- Change title from `'Ausflugsziele im Eichsfeld | Pension Volgenandt'` to `'Ausflugsziele im Eichsfeld'`.

11. **app/pages/impressum.vue** -- Change title from `'Impressum | Pension Volgenandt'` to `'Impressum'`.

12. **app/pages/datenschutz.vue** -- Change title from `'Datenschutzerklaerung | Pension Volgenandt'` to `'Datenschutzerklaerung'`.

13. **app/pages/agb.vue** -- Change title from `'AGB | Pension Volgenandt'` to `'AGB'`.

NOTE: The `ausflugsziele/[slug].vue` page reads title from YAML `seoTitle` field. These values do NOT contain "| Pension Volgenandt" (e.g. "Baerenpark Worbis | Pension nahe Baerenpark" = 44 chars). With titleTemplate appending " | Pension Volgenandt" this becomes "Baerenpark Worbis | Pension nahe Baerenpark | Pension Volgenandt" = 65 chars which exceeds 60. FIX: Update the 5 attraction YAML seoTitle values to be shorter (max ~38 chars to stay under 60 with template). New values:

- baerenpark-worbis.yml: `seoTitle: "Baerenpark Worbis -- Ausflug"` -- too short. Better: keep the original but check total length. "Baerenpark Worbis | Pension nahe Baerenpark | Pension Volgenandt" = 64 chars. Trim to: `seoTitle: "Baerenpark Worbis"` (18 chars + " | Pension Volgenandt" = 40 chars). But this loses SEO keywords. Better approach: use `titleTemplate: '%s'` on the attraction detail page to skip the site name suffix, since the YAML seoTitle is designed to contain keyword-rich titles already. Add `useHead({ titleTemplate: '%s' })` in `app/pages/ausflugsziele/[slug].vue` to override the default template for this specific page.

ALSO do the same for `app/pages/aktivitaeten/wandern.vue` and `app/pages/aktivitaeten/radfahren.vue` -- check if their seoTitle from YAML is used. Looking at the code: these pages use useSeoMeta with hardcoded titles, not from YAML. Just strip " | Pension Volgenandt" from those titles.

**Verify robots.txt:**
After `nuxt generate`, check that `.output/public/robots.txt` exists. If it does not, check `.output/public/_robots.txt` or the server route. The @nuxtjs/robots module generates robots.txt; for SSG it should end up as a static file. If not present, add a manual `public/robots.txt` as a fallback.
</action>
<verify>
After `pnpm build` (or `npx nuxi generate`):

1. Check title lengths in prerendered HTML:

   ```bash
   grep -oP '<title>[^<]+</title>' .output/public/index.html
   grep -oP '<title>[^<]+</title>' .output/public/familie/index.html
   grep -oP '<title>[^<]+</title>' .output/public/zimmer/emils-kuhwiese/index.html
   ```

   Expected: All titles max 60 chars, no "Pension Volgenandt" duplication.

2. Check homepage OG tags:

   ```bash
   grep 'og:image' .output/public/index.html
   grep 'og:description' .output/public/index.html
   grep 'hreflang' .output/public/index.html
   ```

   Expected: og:image, og:description, and hreflang=de all present.

3. Check room page OG tags:

   ```bash
   grep 'og:image' .output/public/zimmer/emils-kuhwiese/index.html
   grep 'hreflang' .output/public/zimmer/emils-kuhwiese/index.html
   ```

   Expected: og:image and hreflang=de present.

4. Check robots.txt:

   ```bash
   cat .output/public/robots.txt
   ```

   Expected: Contains User-agent and Sitemap directive.

5. Verify NO title exceeds 60 chars:
   ```bash
   for f in $(find .output/public -name "index.html"); do
     title=$(grep -oP '<title>\K[^<]+' "$f" 2>/dev/null)
     len=${#title}
     if [ "$len" -gt 60 ]; then echo "OVER 60: $f ($len chars): $title"; fi
   done
   ```
   Expected: No output (all titles under 60 chars).
   </verify>
   <done>
   All page meta titles are max 60 characters with no duplicate "Pension Volgenandt" suffix. Homepage has og:image, og:description, and hreflang=de. Room detail pages have og:image, og:description, and hreflang=de. Room overview page has og:image and hreflang. robots.txt is generated and accessible in the static output. Attraction page titles stay under 60 chars via titleTemplate override.
   </done>
   </task>

</tasks>

<verification>
1. `pnpm build` completes without errors
2. Homepage HTML contains `@type":"BedAndBreakfast"` (not LocalBusiness)
3. Subpage HTML (e.g. /familie/) contains `BreadcrumbList` JSON-LD
4. No page title in any prerendered HTML exceeds 60 characters
5. No page title contains duplicate "Pension Volgenandt" strings
6. Homepage HTML contains og:image, og:description, hreflang=de
7. Room detail page HTML contains og:image, og:description, hreflang=de
8. `.output/public/robots.txt` exists with valid content
9. No non-standard `subtype` property in any JSON-LD output
</verification>

<success_criteria>

- Google Rich Results Test would validate BedAndBreakfast schema on homepage
- BreadcrumbList schema present on all subpages
- All meta titles under 60 characters
- OG tags and hreflang complete on every page
- robots.txt accessible for crawlers
  </success_criteria>

<output>
After completion, create `.planning/phases/04-content-pages-attractions-seo/04-04-SUMMARY.md`
</output>
