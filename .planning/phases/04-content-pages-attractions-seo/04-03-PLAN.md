---
phase: 04-content-pages-attractions-seo
plan: 03
type: execute
wave: 2
depends_on: ['04-01']
files_modified:
  - app/pages/ausflugsziele/index.vue
  - app/pages/ausflugsziele/[slug].vue
  - app/pages/aktivitaeten/wandern.vue
  - app/pages/aktivitaeten/radfahren.vue
  - app/components/attractions/Card.vue
  - app/components/attractions/Map.vue
  - app/pages/[...slug].vue
  - app/error.vue
  - app/pages/zimmer/[slug].vue
  - nuxt.config.ts
autonomous: true

must_haves:
  truths:
    - 'Visitor can navigate to /ausflugsziele/ and sees a consent-gated OpenStreetMap with pins for 5 attractions and the pension, plus a card grid linking to each attraction detail page'
    - 'Visitor can navigate to /ausflugsziele/baerenpark-worbis/ (and 4 other slugs) and sees a full attraction landing page with H1 keyword, distance badge, intro, 3-5 paragraph content, host tip, practical info (hours, price), and booking CTA'
    - 'Visitor can navigate to /aktivitaeten/wandern/ and sees region overview, 3 hiking routes with difficulty badges, and links to komoot/outdooractive'
    - 'Visitor can navigate to /aktivitaeten/radfahren/ and sees cycling overview, 3 routes including Leine-Radweg, and external portal links'
    - 'Navigating to a non-existent URL shows a styled 404 page with links to Startseite, Zimmer, and Kontakt'
    - 'Room detail pages (/zimmer/[slug]) include HotelRoom+Offer Schema.org structured data (if Phase 2 room pages exist; otherwise a TODO placeholder is added)'
    - 'All Phase 4 pages are listed in nitro.prerender.routes in nuxt.config.ts'
  artifacts:
    - path: 'app/pages/ausflugsziele/index.vue'
      provides: 'Ausflugsziele overview page with consent-gated map and attraction card grid'
    - path: 'app/pages/ausflugsziele/[slug].vue'
      provides: 'Attraction detail page template rendering from YAML data'
    - path: 'app/pages/aktivitaeten/wandern.vue'
      provides: 'Wandern activity page with region overview and 3 routes'
    - path: 'app/pages/aktivitaeten/radfahren.vue'
      provides: 'Radfahren activity page with region overview and 3 routes'
    - path: 'app/components/attractions/Card.vue'
      provides: 'Attraction photo card for overview grid'
    - path: 'app/components/attractions/Map.vue'
      provides: 'Leaflet map with attraction pins'
    - path: 'app/pages/[...slug].vue'
      provides: 'Catch-all 404 route'
    - path: 'app/error.vue'
      provides: 'Custom 404 error page with navigation'
    - path: 'app/pages/zimmer/[slug].vue'
      provides: 'HotelRoom+Offer schema added to existing room detail page'
  key_links:
    - from: 'app/pages/ausflugsziele/[slug].vue'
      to: 'content/attractions/*.yml'
      via: "queryCollection('attractions').where('slug', slug)"
      pattern: 'queryCollection.*attractions'
    - from: 'app/pages/aktivitaeten/wandern.vue'
      to: 'content/activities/wandern.yml'
      via: "queryCollection('activities').where('slug', 'wandern')"
      pattern: 'queryCollection.*activities'
    - from: 'app/components/attractions/Map.vue'
      to: '@nuxtjs/leaflet'
      via: 'LMap, LTileLayer, LMarker components'
      pattern: 'LMap'
    - from: 'app/pages/zimmer/[slug].vue'
      to: 'nuxt-schema-org'
      via: 'useSchemaOrg with HotelRoom+Offer'
      pattern: 'useSchemaOrg.*HotelRoom'
---

<objective>
Build the Ausflugsziele overview page with interactive map and card grid, 5 attraction detail pages from YAML data, 2 activity pages (Wandern, Radfahren), a custom 404 page, HotelRoom+Offer structured data on room pages, and Phase 4 prerender routes.

Purpose: The attraction landing pages target uncontested local SEO keywords like "Pension nahe Baerenpark Worbis" and serve as the site's primary content marketing asset. The overview map creates a visual hub for exploring the Eichsfeld region. Activity pages link to external route portals while keeping visitors on-site for accommodation decisions.

Output: 1 overview page with map, 1 dynamic attraction template rendering 5 pages, 2 activity pages, 1 custom 404, HotelRoom schema on room pages, and updated prerender config.
</objective>

<execution_context>
@C:\Users\bernt\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\bernt\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-content-pages-attractions-seo/04-CONTEXT.md
@.planning/phases/04-content-pages-attractions-seo/04-RESEARCH.md
@.planning/phases/04-content-pages-attractions-seo/04-01-SUMMARY.md

Key dependencies from 04-01:

- PageBanner, FeatureGrid, SoftCta, BookingCta, DistanceBadge, HostTip components exist
- BreadcrumbNav exists with useBreadcrumbItems() integration
- MapConsent exists in app/components/attractions/ (created in 04-01, shared component)
- content/attractions/\*.yml has 5 YAML files with full content, coordinates, and practical info
- content/activities/\*.yml has 2 YAML files with routes and external links
- @nuxtjs/seo, @nuxtjs/leaflet configured in nuxt.config.ts
- Room pages exist from Phase 2 at app/pages/zimmer/[slug].vue
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Create Ausflugsziele overview page, attraction card, and map components</name>
  <files>
    app/pages/ausflugsziele/index.vue
    app/components/attractions/Card.vue
    app/components/attractions/Map.vue
  </files>
  <action>
1. **app/components/attractions/Card.vue** -- Photo card for the attraction overview grid. Props: `name: string`, `slug: string`, `heroImage: string`, `heroImageAlt: string`, `distanceKm: number`, `drivingMinutes: number`, `shortDescription: string`, `category: string`. Renders as a NuxtLink to `/ausflugsziele/${slug}/`. Structure:
   - NuxtImg of heroImage (aspect-video, object-cover, rounded-t-lg)
   - Card body below image: name as h3 (font-serif, text-lg font-semibold), DistanceBadge component, one-line shortDescription, arrow icon (ph:arrow-right)
   - Card styling: bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow overflow-hidden
   - Category badge in top-right corner of image (absolute positioned): natur=sage, kultur=waldhonig, aktivitaet=charcoal

2. **app/components/attractions/Map.vue** -- Leaflet map with attraction pins. Props: `attractions: Array<{ name, slug, coordinates: { lat, lng }, distanceKm, shortDescription }>`. Center on pension coordinates [51.3747, 10.2197] at zoom 10. Renders:
   - LMap with `use-global-leaflet: false`, full width/height from parent
   - LTileLayer from `https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png` with OSM attribution
   - Pension marker at [51.3747, 10.2197] with LPopup: "Pension Volgenandt" + address
   - One marker per attraction at attraction.coordinates with LPopup: attraction name + distance + NuxtLink to detail page
     See Pattern in 04-RESEARCH.md for Leaflet map code.

3. **app/pages/ausflugsziele/index.vue** -- Overview page per CONTEXT.md: map + card grid.
   - SEO title: "Ausflugsziele im Eichsfeld | Pension Volgenandt" (47 chars)
   - SEO description: "Baerenpark, Burgen und Natur: Entdecken Sie die besten Ausflugsziele rund um die Pension Volgenandt im Eichsfeld." (~114 chars)
   - definePageMeta({ breadcrumb: { label: 'Ausflugsziele' } })
   - PageBanner: `/img/banners/ausflugsziele-banner.webp`, "Ausflugsziele", subtitle "Entdecken Sie das Eichsfeld"
   - Fetch all attractions: `const { data: attractions } = await useAsyncData('attractions', () => queryCollection('attractions').order('sortOrder', 'ASC').all())`
   - Also fetch activities for the card grid: `const { data: activities } = await useAsyncData('activities', () => queryCollection('activities').all())`
   - Section 1: Consent-gated map (AttractionsMapConsent wrapping AttractionsMap)
     - Placeholder image: `/img/map/ausflugsziele-placeholder.webp`
     - MapConsent component is guaranteed to exist from 04-01 (Wave 1).
   - Section 2: "Unsere Empfehlungen" heading, then card grid
     - `grid gap-6 sm:grid-cols-2 lg:grid-cols-3` of AttractionsCard components
     - Iterate over attractions array
   - Section 3: "Aktivitaeten" subsection with 2 cards for Wandern (/aktivitaeten/wandern/) and Radfahren (/aktivitaeten/radfahren/) -- simpler cards than attraction cards (icon + title + description + link)
   - BookingCta at bottom with text "Nach einem Ausflugstag zurueck in Ihre gemuetliche Pension"
     </action>
     <verify>
     All 3 files exist: `ls app/pages/ausflugsziele/index.vue app/components/attractions/Card.vue app/components/attractions/Map.vue`
     Overview page fetches attractions: `grep -c "queryCollection.*attractions" app/pages/ausflugsziele/index.vue` returns >= 1
     Map component uses Leaflet: `grep -c "LMap" app/components/attractions/Map.vue` returns >= 1
     Run `pnpm typecheck` -- no errors.
     </verify>
     <done>
     Ausflugsziele overview page renders consent-gated map with pension + attraction pins and a card grid of all 5 attractions plus 2 activity links. Card component shows photo, name, distance badge, description, and category badge.
     </done>
     </task>

<task type="auto">
  <name>Task 2: Create attraction detail template and activity pages</name>
  <files>
    app/pages/ausflugsziele/[slug].vue
    app/pages/aktivitaeten/wandern.vue
    app/pages/aktivitaeten/radfahren.vue
  </files>
  <action>
1. **app/pages/ausflugsziele/[slug].vue** -- Dynamic attraction detail page. Fetches attraction data by slug from YAML collection.
   - Route param: `const route = useRoute(); const slug = route.params.slug as string`
   - Fetch data: `const { data: attraction } = await useAsyncData(\`attraction-${slug}\`, () => queryCollection('attractions').where('slug', slug).first())`
   - Handle 404: If `!attraction.value`, throw `createError({ statusCode: 404 })`
   - SEO from YAML: `useSeoMeta({ title: attraction.seoTitle, description: attraction.seoDescription, ogTitle: attraction.seoTitle, ogDescription: attraction.seoDescription, ogImage: \`https://www.pension-volgenandt.de${attraction.heroImage}\` })`
   - Canonical URL and hreflang: `useHead({ link: [{ rel: 'canonical', href: \`https://www.pension-volgenandt.de/ausflugsziele/${slug}/\` }, { rel: 'alternate', hreflang: 'de', href: \`https://www.pension-volgenandt.de/ausflugsziele/${slug}/\` }] })`
   - Breadcrumb: Use `useBreadcrumbItems({ overrides: [undefined, undefined, { label: attraction.value?.name }] })` to set the dynamic label from the attraction name. Do NOT use definePageMeta for the breadcrumb label since it cannot accept reactive values.
   - Page structure (mini travel guide depth per CONTEXT.md):
     a. PageBanner with attraction heroImage and name as H1
     b. DistanceBadge below banner (prominent, before intro)
     c. Personal intro section (attraction.intro, 2-3 sentences)
     d. Main content section (attraction.content -- render as multiple paragraphs, split on double newlines)
     e. HostTip component with attraction.hostTip
     f. Practical info box (if available):
        - Oeffnungszeiten (attraction.openingHours) with ph:clock icon
        - Eintritt (attraction.entryPrice) with ph:ticket icon
        - Beste Reisezeit (attraction.bestTimeToVisit) with ph:calendar icon
        - Website link (attraction.website) with ph:globe icon
     g. Photo gallery (if attraction.gallery.length > 0): grid of NuxtImg, 2 cols on mobile, 3 on desktop
     h. Soft CTA: "Planen Sie Ihren Ausflug zum [name] -- wir beraten Sie gerne!"
     i. BookingCta: "Uebernachten Sie bei uns -- nur [distanceKm] km entfernt"

2. **app/pages/aktivitaeten/wandern.vue** -- Wandern activity page per CONTEXT.md.
   - SEO: useSeoMeta() with title and description from YAML seoTitle/seoDescription, ogTitle, ogDescription, ogImage
   - useHead() for canonical URL (`https://www.pension-volgenandt.de/aktivitaeten/wandern/`) and hreflang: `{ link: [{ rel: 'canonical', href: 'https://www.pension-volgenandt.de/aktivitaeten/wandern/' }, { rel: 'alternate', hreflang: 'de', href: 'https://www.pension-volgenandt.de/aktivitaeten/wandern/' }] }`
   - Fetch: `queryCollection('activities').where('slug', 'wandern').first()`
   - definePageMeta({ breadcrumb: { label: 'Wandern' } })
   - PageBanner with activity heroImage
   - Personal intro section (activity.intro)
   - Region description section (activity.regionDescription) -- general overview of Eichsfeld hiking character
   - Route cards section: "Unsere Wanderempfehlungen" heading, then 3 route cards:
     - Each card: route.name (h3), route.distance + route.difficulty badge (leicht=sage, mittel=waldhonig, schwer=charcoal), route.highlight text, external link to route.externalUrl (opens in new tab with rel="noopener noreferrer")
     - Card styling: bordered cards with icon (ph:path-duotone or ph:mountains-duotone)
   - External portals section: "Weitere Routen finden" with links to activity.externalPortals (komoot, outdooractive)
   - SoftCta + BookingCta

3. **app/pages/aktivitaeten/radfahren.vue** -- Radfahren activity page. Same structure as wandern.vue but:
   - SEO: useSeoMeta() with title and description from YAML seoTitle/seoDescription, ogTitle, ogDescription, ogImage
   - useHead() for canonical URL (`https://www.pension-volgenandt.de/aktivitaeten/radfahren/`) and hreflang: `{ link: [{ rel: 'canonical', href: 'https://www.pension-volgenandt.de/aktivitaeten/radfahren/' }, { rel: 'alternate', hreflang: 'de', href: 'https://www.pension-volgenandt.de/aktivitaeten/radfahren/' }] }`
   - Fetch: `queryCollection('activities').where('slug', 'radfahren').first()`
   - definePageMeta({ breadcrumb: { label: 'Radfahren' } })
   - Route cards with cycling-specific icon (ph:bicycle-duotone)
   - Content about Leine-Radweg and Eichsfeld cycling

NOTE: Both activity pages follow the same structure. Consider if a shared layout or component makes sense, but since there are only 2 and their content differs, keep them as separate page files.
</action>
<verify>
All 3 files exist: `ls app/pages/ausflugsziele/\\[slug\\].vue app/pages/aktivitaeten/wandern.vue app/pages/aktivitaeten/radfahren.vue`
Attraction template fetches by slug: `grep -c "queryCollection.*attractions" app/pages/ausflugsziele/\\[slug\\].vue` returns >= 1
Activity pages fetch data: `grep -c "queryCollection.*activities" app/pages/aktivitaeten/wandern.vue` returns >= 1
Run `pnpm typecheck` -- no errors.
</verify>
<done>
Attraction detail template renders all 5 attraction pages from YAML data with full content, host tips, practical info, and SEO meta. 2 activity pages show region overview, 3 routes each with difficulty badges, and external portal links.
</done>
</task>

<task type="auto">
  <name>Task 3: Add HotelRoom schema to room pages, create 404 page, and update prerender routes</name>
  <files>
    app/pages/zimmer/[slug].vue
    app/pages/[...slug].vue
    app/error.vue
    nuxt.config.ts
  </files>
  <action>
1. **HotelRoom + Offer Schema on room detail pages** -- Add Schema.org structured data to the existing room detail page at `app/pages/zimmer/[slug].vue`. This file was created in Phase 2. Add a `useSchemaOrg()` call after the existing setup code:
   ```typescript
   useSchemaOrg([
     {
       '@type': ['HotelRoom', 'Product'],
       name: room.value.name,
       description: room.value.shortDescription,
       image: `https://www.pension-volgenandt.de${room.value.heroImage}`,
       occupancy: {
         '@type': 'QuantitativeValue',
         maxValue: room.value.maxGuests,
       },
       bed: {
         '@type': 'BedDetails',
         typeOfBed: room.value.beds,
       },
       amenityFeature: room.value.amenities.map(a => ({
         '@type': 'LocationFeatureSpecification',
         name: amenityMap[a]?.label ?? a,
         value: true,
       })),
       offers: room.value.pricing.flatMap(period =>
         period.rates.map(rate => ({
           '@type': 'Offer',
           name: `${room.value.name} - ${period.label}`,
           priceSpecification: {
             '@type': 'UnitPriceSpecification',
             price: rate.pricePerNight,
             priceCurrency: 'EUR',
             unitCode: 'DAY',
           },
           businessFunction: 'http://purl.org/goodrelations/v1#LeaseOut',
           eligibleQuantity: {
             '@type': 'QuantitativeValue',
             value: rate.occupancy,
             unitText: 'Personen',
           },
         }))
       ),
     },
   ])
   ```
   IMPORTANT: Read the existing room page code first to understand the data structure (room variable name, property names). The schema code above uses assumed property names from the Phase 2 room YAML schema. Adapt the property paths to match the actual room data structure. If the room page doesn't exist yet (Phase 2 not complete), create a placeholder file with a TODO comment.

2. **Custom 404 page** -- Two files needed:

   **app/pages/[...slug].vue** (catch-all route):

   ```vue
   <script setup lang="ts">
   throw createError({
     statusCode: 404,
     message: 'Seite nicht gefunden',
   })
   </script>
   ```

   **app/error.vue** (error page template):
   - Full page layout with centered content
   - Large "404" number: `font-serif text-6xl font-bold text-sage-300`
   - "Seite nicht gefunden" heading: `text-2xl font-semibold text-sage-900`
   - Description: "Die gesuchte Seite existiert leider nicht oder wurde verschoben."
   - 3 navigation links:
     - "Zur Startseite" (/) -- waldhonig button
     - "Zimmer ansehen" (/zimmer/) -- sage-100 button
     - "Kontakt" (/kontakt/) -- sage-100 button
   - Centered layout with `min-h-screen flex flex-col items-center justify-center`
   - See Pattern 12 in 04-RESEARCH.md.

3. **Update prerender routes in nuxt.config.ts** -- Add all Phase 4 routes to `nitro.prerender.routes`. Keep existing routes and append:

   ```typescript
   nitro: {
     prerender: {
       crawlLinks: true,
       routes: [
         // ... existing routes from earlier phases ...
         // Phase 4 content pages
         '/familie/',
         '/aktivitaeten/',
         '/nachhaltigkeit/',
         '/kontakt/',
         // Phase 4 attraction pages
         '/ausflugsziele/',
         '/ausflugsziele/baerenpark-worbis/',
         '/ausflugsziele/burg-bodenstein/',
         '/ausflugsziele/burg-hanstein/',
         '/ausflugsziele/skywalk-sonnenstein/',
         '/ausflugsziele/baumkronenpfad-hainich/',
         // Phase 4 activity pages
         '/aktivitaeten/wandern/',
         '/aktivitaeten/radfahren/',
       ],
     },
   },
   ```

   If `crawlLinks: true` is not already set, add it. If `failOnError: false` exists, keep it.

4. **Verify all pages have SEO meta** -- Quick check that all pages created in 04-02 and 04-03 have `useSeoMeta()` and `useHead()` calls. If running after 04-02, verify those files too. If running in parallel, only verify 04-03 files.
   </action>
   <verify>
   404 files exist: `ls app/pages/\\[...slug\\].vue app/error.vue`
   Room page has schema: `grep -c "HotelRoom\|useSchemaOrg" app/pages/zimmer/\\[slug\\].vue` returns >= 1 (or file has TODO if Phase 2 not complete)
   Prerender routes include Phase 4 paths: `grep -c "ausflugsziele" nuxt.config.ts` returns >= 1
   Run `pnpm build 2>&1 | tail -20` -- build completes without errors.
   </verify>
   <done>
   HotelRoom+Offer Schema.org on room pages (or TODO if Phase 2 incomplete). Custom 404 page with styled error template and navigation links. All Phase 4 routes added to prerender config. Full build passes.
   </done>
   </task>

</tasks>

<verification>
1. Navigate to /ausflugsziele/ -- sees map placeholder and card grid with 5 attractions + 2 activities
2. Click "Karte laden" -- interactive Leaflet map loads with pins
3. Navigate to /ausflugsziele/baerenpark-worbis/ -- sees full attraction page with content
4. Navigate to /aktivitaeten/wandern/ -- sees region overview and 3 routes
5. Navigate to /aktivitaeten/radfahren/ -- sees cycling page with routes
6. Navigate to /this-page-does-not-exist -- sees styled 404 page
7. View page source on /zimmer/[any-room]/ -- HotelRoom JSON-LD present
8. `pnpm build` completes with all routes prerendered
9. All pages have unique title and description meta tags
</verification>

<success_criteria>

- Ausflugsziele overview with consent-gated map and card grid
- 5 attraction detail pages rendered from YAML data with SEO keywords
- 2 activity pages with routes and external portal links
- Custom 404 page with navigation
- HotelRoom+Offer schema on room pages
- All Phase 4 routes in prerender config
- Build passes cleanly
  </success_criteria>

<output>
After completion, create `.planning/phases/04-content-pages-attractions-seo/04-03-SUMMARY.md`
</output>
