---
phase: 02-content-infrastructure-room-pages
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - nuxt.config.ts
  - content.config.ts
  - app/utils/amenities.ts
  - content/rooms/emils-kuhwiese.yml
  - content/rooms/schoene-aussicht.yml
  - content/rooms/balkonzimmer.yml
  - content/rooms/rosengarten.yml
  - content/rooms/wohlfuehl-appartement.yml
  - content/rooms/doppelzimmer.yml
  - content/rooms/einzelzimmer.yml
autonomous: true

must_haves:
  truths:
    - 'Room data lives in YAML files (`content/rooms/*.yml`) validated by Zod schemas'
    - 'Adding a new room YAML file automatically generates a new room page at build time'
    - "queryCollection('rooms') returns all 7 rooms with correct types"
    - 'Amenity enum values map to Lucide icon names and German labels'
  artifacts:
    - path: 'content.config.ts'
      provides: 'Rooms data collection with Zod schema'
      contains: 'defineCollection'
    - path: 'app/utils/amenities.ts'
      provides: 'Amenity-to-icon/label mapping'
      exports: ['amenityMap', 'AmenityInfo']
    - path: 'content/rooms/emils-kuhwiese.yml'
      provides: "Room data for Emil's Kuhwiese"
      contains: 'beds24PropertyId: 257613'
    - path: 'content/rooms/schoene-aussicht.yml'
      provides: 'Room data for Schoene Aussicht'
      contains: 'beds24PropertyId: 257610'
    - path: 'content/rooms/balkonzimmer.yml'
      provides: 'Room data for Balkonzimmer'
    - path: 'content/rooms/rosengarten.yml'
      provides: 'Room data for Rosengarten'
    - path: 'content/rooms/wohlfuehl-appartement.yml'
      provides: 'Room data for Wohlfuehl-Appartement'
    - path: 'content/rooms/doppelzimmer.yml'
      provides: 'Room data for Doppelzimmer'
    - path: 'content/rooms/einzelzimmer.yml'
      provides: 'Room data for Einzelzimmer'
  key_links:
    - from: 'content.config.ts'
      to: 'content/rooms/*.yml'
      via: 'source glob pattern'
      pattern: "source:\\s*['\"]rooms/\\*\\.yml['\"]"
    - from: 'nuxt.config.ts'
      to: '@nuxt/icon'
      via: 'modules array'
      pattern: '@nuxt/icon'
---

<objective>
Set up the Nuxt Content v3 data collection for rooms with Zod validation, create all 7 room YAML data files, configure the icon module for amenity display, and add SSG prerender routes for all room pages.

Purpose: Establishes the content infrastructure that all room page components depend on. Without validated room data and the icon system, no room UI can be built.
Output: Working content.config.ts with rooms collection, 7 validated YAML room files, amenity icon mapping utility, and nuxt.config.ts updates.
</objective>

<execution_context>
@C:\Users\bernt\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\bernt\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-content-infrastructure-room-pages/02-RESEARCH.md
@.planning/phases/02-content-infrastructure-room-pages/02-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Phase 2 dependencies and configure modules</name>
  <files>
    nuxt.config.ts
  </files>
  <action>
Install Phase 2 npm dependencies:
```bash
pnpm add -D @nuxt/icon @iconify-json/lucide
pnpm add focus-trap
```

Update `nuxt.config.ts` to:

1. Add `@nuxt/icon` to the `modules` array (after existing modules from Phase 1).

2. Configure `@nuxt/icon` options -- use the `lucide` collection with server bundle for SSG:

```typescript
icon: {
  serverBundle: 'local',
},
```

3. Add SSG prerender routes for all room pages as a safety net (crawlLinks should discover them, but explicit routes prevent gaps). Add these to `nitro.prerender.routes`:

```typescript
nitro: {
  prerender: {
    crawlLinks: true,
    routes: [
      '/zimmer/',
      '/zimmer/emils-kuhwiese',
      '/zimmer/schoene-aussicht',
      '/zimmer/balkonzimmer',
      '/zimmer/rosengarten',
      '/zimmer/wohlfuehl-appartement',
      '/zimmer/doppelzimmer',
      '/zimmer/einzelzimmer',
    ],
  },
},
```

IMPORTANT: Merge with existing nuxt.config.ts content from Phase 1. Do NOT overwrite existing modules, plugins, or configuration. Add to the existing arrays/objects.

Do NOT install `@nuxt/content`, `@vueuse/nuxt`, or `@nuxt/image` -- these are already installed from Phase 1.
</action>
<verify>
Run `pnpm ls @nuxt/icon @iconify-json/lucide focus-trap` to confirm all three packages are installed.
Run `pnpm typecheck` to confirm no TypeScript errors in nuxt.config.ts.
</verify>
<done>
`@nuxt/icon`, `@iconify-json/lucide`, and `focus-trap` are installed. nuxt.config.ts has `@nuxt/icon` in modules, icon server bundle configured, and all 7 room prerender routes listed.
</done>
</task>

<task type="auto">
  <name>Task 2: Create content collection schema, amenity utility, and room YAML data</name>
  <files>
    content.config.ts
    app/utils/amenities.ts
    content/rooms/emils-kuhwiese.yml
    content/rooms/schoene-aussicht.yml
    content/rooms/balkonzimmer.yml
    content/rooms/rosengarten.yml
    content/rooms/wohlfuehl-appartement.yml
    content/rooms/doppelzimmer.yml
    content/rooms/einzelzimmer.yml
  </files>
  <action>
**1. Create `content.config.ts` at the project root** (NOT inside `app/`).

Define a `rooms` data collection with `type: 'data'` and `source: 'rooms/*.yml'`. Use the Zod schema from the research document (Pattern 1), which includes:

- `name` (string) -- room display name
- `slug` (string) -- URL slug, must match filename stem
- `type` (enum: 'ferienwohnung', 'doppelzimmer', 'einzelzimmer') -- room category key
- `category` (string) -- display label ("Ferienwohnung", "Doppelzimmer", etc.)
- `shortDescription` (string) -- 2-3 sentences for card view
- `description` (string) -- full description for detail page
- `beds24PropertyId` (number) -- Beds24 property ID
- `beds24RoomId` (number, optional) -- Beds24 room ID
- `maxGuests` (number) -- max occupancy
- `beds` (string) -- bed description
- `sizeM2` (number, optional) -- room size in m2
- `pricing` -- array of pricing periods, each with `label`, optional `dateRange`, and `rates` array (each rate has `occupancy` number and `pricePerNight` number). Min 1 period.
- `startingPrice` (number) -- lowest "ab" price for card display
- `heroImage` (string) -- hero image path
- `heroImageAlt` (string) -- hero image alt text
- `gallery` -- array of `{ src: string, alt: string }` objects
- `amenities` -- array of amenity enum values
- `highlights` -- array of strings (2-3 key features for cards)
- `extras` -- array of `{ name: string, description?: string, price: number, unit: string }`, default empty
- `sortOrder` (number, default 0) -- CRITICAL: must have `.default(0)` to prevent NULL sort issues
- `featured` (boolean, default false) -- for homepage room preview in Phase 3

Use `z.enum()` for the amenity values. The full enum list:
`wifi`, `tv`, `balkon`, `terrasse`, `kueche`, `kuehlschrank`, `kaffeemaschine`, `dusche`, `badewanne`, `parkplatz`, `garten`, `bettwaesche`, `handtuecher`, `foehn`, `schreibtisch`, `heizung`

**2. Create `app/utils/amenities.ts`** with the `AmenityInfo` interface and `amenityMap` record mapping each amenity enum value to a Lucide icon name and German label. Follow the exact mapping from research Pattern 5:

```
wifi -> lucide:wifi -> "Kostenloses WLAN"
tv -> lucide:tv -> "Fernseher"
balkon -> lucide:fence -> "Balkon"
terrasse -> lucide:sun -> "Terrasse"
kueche -> lucide:cooking-pot -> "Kueche"
kuehlschrank -> lucide:refrigerator -> "Kuehlschrank"
kaffeemaschine -> lucide:coffee -> "Kaffeemaschine"
dusche -> lucide:shower-head -> "Dusche"
badewanne -> lucide:bath -> "Badewanne"
parkplatz -> lucide:circle-parking -> "Kostenloser Parkplatz"
garten -> lucide:trees -> "Garten"
bettwaesche -> lucide:bed -> "Bettwaesche inklusive"
handtuecher -> lucide:hand -> "Handtuecher"
foehn -> lucide:wind -> "Foehn"
schreibtisch -> lucide:lamp-desk -> "Schreibtisch"
heizung -> lucide:heater -> "Heizung"
```

Note: Use proper German umlauts in the label strings (Kuche -> Kueche, etc). Actually, use real umlauts: "Kueche" -> "Kuche" is WRONG. Use "Kuche" with u-umlaut: "Küche". All labels should use proper German: "Küche", "Kühlschrank", "Bettwäsche", "Handtücher", "Föhn".

Export both `AmenityInfo` (interface) and `amenityMap` (Record<string, AmenityInfo>).

**3. Create 7 room YAML files** in `content/rooms/`. Use data from the current pension-volgenandt.de website and the Beds24 property IDs from PROJECT.md:

- **3 Beds24 properties:**
  - Emil's Kuhwiese: beds24PropertyId 257613 (Ferienwohnung)
  - Schone Aussicht: beds24PropertyId 257610 (Ferienwohnung)
  - Pension Volgenandt: beds24PropertyId 261258 (covers Balkonzimmer, Rosengarten, Wohlfuehl-Appartement, Doppelzimmer, Einzelzimmer)

- **7 rooms with realistic placeholder data:**
  1. `emils-kuhwiese.yml` -- Ferienwohnung, ~45m2, 4 guests, sortOrder 1, featured true
  2. `schoene-aussicht.yml` -- Ferienwohnung, ~40m2, 3 guests, sortOrder 2, featured true
  3. `wohlfuehl-appartement.yml` -- Ferienwohnung, ~50m2, 4 guests, sortOrder 3, featured true
  4. `balkonzimmer.yml` -- Doppelzimmer with balcony, ~25m2, 2 guests, sortOrder 4
  5. `rosengarten.yml` -- Doppelzimmer, ~22m2, 2 guests, sortOrder 5
  6. `doppelzimmer.yml` -- Doppelzimmer, ~20m2, 2 guests, sortOrder 6
  7. `einzelzimmer.yml` -- Einzelzimmer, ~15m2, 1 guest, sortOrder 7

- Each room must have:
  - A single "Standardpreis" pricing period with 1- and 2-person rates (or just 1-person for Einzelzimmer). Use realistic prices: Ferienwohnungen 55-75 EUR, Doppelzimmer 45-60 EUR, Einzelzimmer 35-45 EUR.
  - `startingPrice` set to the lowest rate in the pricing array
  - `heroImage` pointing to `/img/rooms/{slug}-hero.jpg` (placeholder path -- actual photos TBD)
  - `gallery` with 3-5 placeholder entries using `/img/rooms/{slug}-{n}.jpg` pattern
  - Appropriate amenities from the enum (all rooms get wifi, tv, bettwaesche, handtuecher, dusche, heizung; Ferienwohnungen additionally get kueche, kuehlschrank, kaffeemaschine; balkonzimmer gets balkon; etc.)
  - 2-3 highlights per room
  - Shared extras: Fruehstueck (EUR 10, "pro Person / Nacht"), Geniesser-Fruehstueck (EUR 15, "pro Person / Nacht"), Hund (EUR 10, "pro Nacht"), BBQ-Set (EUR 10, "pro Nutzung")

- Image filename rules (from research pitfall 3): ASCII only, lowercase, hyphens. No umlauts, spaces, or apostrophes in filenames.

- All prices are EUR amounts including VAT (PAngV compliance per LEGL-07).

- Write German text with proper umlauts in content strings (name, descriptions). Only filenames must be ASCII.
  </action>
  <verify>
  Run `pnpm dev` and check the terminal output for Zod validation errors on room YAML files. There should be zero schema validation failures.

Run `pnpm typecheck` to confirm content.config.ts and amenities.ts have no TypeScript errors.

Verify all 7 YAML files exist:

```bash
ls content/rooms/*.yml | wc -l
# Expected: 7
```

  </verify>
  <done>
`content.config.ts` defines a rooms data collection with complete Zod schema. `app/utils/amenities.ts` exports amenityMap with 16 amenity-to-icon mappings. 7 room YAML files exist in `content/rooms/` with valid data that passes Zod validation. `pnpm dev` starts without content validation errors. `pnpm typecheck` passes.
  </done>
</task>

</tasks>

<verification>
1. `pnpm ls @nuxt/icon @iconify-json/lucide focus-trap` shows all three installed
2. `pnpm typecheck` passes with zero errors
3. `pnpm dev` starts and shows no Zod validation errors for room YAML
4. 7 files exist in `content/rooms/` directory
5. `content.config.ts` exists at project root (not inside app/)
6. `nuxt.config.ts` has `@nuxt/icon` in modules and room prerender routes
</verification>

<success_criteria>

- Nuxt Content v3 rooms collection is defined with full Zod schema
- All 7 room YAML files pass schema validation at build time
- @nuxt/icon module is configured with Lucide icon set
- Amenity utility maps 16 amenity types to icons and German labels
- SSG prerender routes include all room pages as safety net
- Adding an 8th YAML file would automatically be queryable without code changes
  </success_criteria>

<output>
After completion, create `.planning/phases/02-content-infrastructure-room-pages/02-01-SUMMARY.md`
</output>
