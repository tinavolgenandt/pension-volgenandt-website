---
phase: 01-foundation-legal-compliance
plan: 03
type: execute
wave: 3
depends_on: ['01-02']
files_modified:
  - app/composables/useCookieConsent.ts
  - app/components/CookieConsent.vue
  - app/components/CookieSettings.vue
  - app/layouts/default.vue
  - app/components/AppFooter.vue
  - app/pages/impressum.vue
  - app/pages/datenschutz.vue
  - app/pages/agb.vue
autonomous: false

must_haves:
  truths:
    - 'First-time visitor sees a cookie consent banner at the bottom of the page with equal-prominence Accept and Reject buttons'
    - 'After clicking Accept or Reject, the banner disappears and does not reappear on page reload or navigation'
    - 'Clicking Cookie-Einstellungen in the footer opens a settings panel showing three categories (essential always on, booking, media)'
    - 'No third-party requests appear in the browser Network tab before consent is granted'
    - 'Visitor can navigate to /impressum/ and sees a complete Impressum page citing DDG Paragraph 5 with name, address, phone, email, tax ID placeholders'
    - 'Visitor can navigate to /datenschutz/ and sees a comprehensive privacy policy page citing DSGVO and TDDDG Paragraph 25'
    - 'Visitor can navigate to /agb/ and sees booking terms and cancellation policy for a German pension/Beherbergungsbetrieb'
    - 'All three legal pages use Lora serif headings and DM Sans body text with max 70ch line length'
  artifacts:
    - path: 'app/composables/useCookieConsent.ts'
      provides: 'SSR-safe cookie consent state with accept/reject/update/isAllowed/showSettings methods'
      exports: ['useCookieConsent']
      contains: 'useCookie'
    - path: 'app/components/CookieConsent.vue'
      provides: 'Bottom bar consent banner with equal Accept/Reject buttons'
      contains: 'role="dialog"'
    - path: 'app/components/CookieSettings.vue'
      provides: 'Category toggle panel opened from footer link'
      contains: 'essential'
    - path: 'app/pages/impressum.vue'
      provides: 'Legal Impressum page per DDG Paragraph 5'
      contains: 'DDG'
    - path: 'app/pages/datenschutz.vue'
      provides: 'Privacy policy page per DSGVO/TDDDG'
      contains: 'TDDDG'
    - path: 'app/pages/agb.vue'
      provides: 'Booking terms and cancellation policy'
      contains: 'Stornierung'
  key_links:
    - from: 'app/components/CookieConsent.vue'
      to: 'app/composables/useCookieConsent.ts'
      via: 'composable auto-import'
      pattern: 'useCookieConsent'
    - from: 'app/components/CookieSettings.vue'
      to: 'app/composables/useCookieConsent.ts'
      via: 'composable auto-import'
      pattern: 'useCookieConsent'
    - from: 'app/layouts/default.vue'
      to: 'app/components/CookieConsent.vue'
      via: 'auto-imported component in layout'
      pattern: '<CookieConsent'
    - from: 'app/components/AppFooter.vue'
      to: 'app/composables/useCookieConsent.ts'
      via: 'Cookie-Einstellungen button click'
      pattern: "showSettings\\|openSettings"
---

<objective>
Build the cookie consent system (composable, banner, settings panel) and all three legal pages (Impressum, Datenschutz, AGB) with complete German legal text.

Purpose: Eliminates the current Abmahnung risk by providing legally required Impressum, privacy policy, and booking terms. The cookie consent system ensures TDDDG Paragraph 25 compliance and establishes the consent-gating architecture that Phase 5 (Beds24 booking) depends on.

Output: Working cookie consent with three categories, three complete legal pages accessible via footer links, and zero third-party requests before consent.
</objective>

<execution_context>
@C:\Users\bernt\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\bernt\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-legal-compliance/01-CONTEXT.md
@.planning/phases/01-foundation-legal-compliance/01-RESEARCH.md
@.planning/phases/01-foundation-legal-compliance/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Cookie consent composable, banner, and settings panel</name>
  <files>
    app/composables/useCookieConsent.ts
    app/components/CookieConsent.vue
    app/components/CookieSettings.vue
    app/layouts/default.vue
    app/components/AppFooter.vue
  </files>
  <action>
    **useCookieConsent.ts composable:**

    Create an SSR-safe composable using Nuxt's `useCookie` (NOT localStorage -- causes hydration mismatches).

    ```typescript
    interface ConsentPreferences {
      essential: boolean    // Always true, cannot be toggled
      booking: boolean      // Beds24 widget (Phase 5)
      media: boolean        // YouTube, Maps (Phase 3+)
    }

    export function useCookieConsent() {
      const consent = useCookie<ConsentPreferences | null>('cookie_consent', {
        maxAge: 60 * 60 * 24 * 180, // 180 days
        sameSite: 'lax',
        path: '/',
        default: () => null, // null = no choice made yet
      })

      const settingsOpen = ref(false)

      const hasConsented = computed(() => consent.value !== null)

      function acceptAll() {
        consent.value = { essential: true, booking: true, media: true }
      }

      function rejectAll() {
        consent.value = { essential: true, booking: false, media: false }
      }

      function updateCategory(category: keyof ConsentPreferences, value: boolean) {
        if (category === 'essential') return
        if (!consent.value) {
          consent.value = { essential: true, booking: false, media: false }
        }
        consent.value = { ...consent.value, [category]: value }
      }

      function isAllowed(category: keyof ConsentPreferences): boolean {
        if (category === 'essential') return true
        return consent.value?.[category] ?? false
      }

      function openSettings() {
        settingsOpen.value = true
      }

      function closeSettings() {
        settingsOpen.value = false
      }

      function revokeConsent() {
        consent.value = null
      }

      return {
        consent: readonly(consent),
        hasConsented,
        settingsOpen,
        acceptAll,
        rejectAll,
        updateCategory,
        isAllowed,
        openSettings,
        closeSettings,
        revokeConsent,
      }
    }
    ```

    **CookieConsent.vue banner:**

    - Bottom bar (full-width), NOT a modal -- per CONTEXT decision
    - `v-if="!hasConsented"` -- use v-if NOT v-show (LEGL-06 requirement: no third-party loading before consent)
    - Position: `fixed inset-x-0 bottom-0 z-50`
    - Background: `bg-warm-white border-t border-sage-200 shadow-lg`
    - Container: `mx-auto max-w-screen-xl p-4 sm:p-6`
    - `role="dialog" aria-label="Cookie-Einstellungen"` for accessibility
    - Text: "Wir verwenden Cookies, um Ihnen die bestmogliche Erfahrung zu bieten. Weitere Informationen finden Sie in unserer [Datenschutzerklarung](/datenschutz)." (use proper umlauts)
    - Text style: `font-sans text-base text-sage-700`
    - The NuxtLink to /datenschutz should be underlined

    **Two equal-prominence buttons (TDDDG Paragraph 25 / LEGL-04):**
    - "Alle akzeptieren" -- `bg-waldhonig-500 text-white px-6 py-3 rounded-lg font-sans font-semibold`
    - "Nur Notwendige" -- `bg-sage-700 text-white px-6 py-3 rounded-lg font-sans font-semibold`
    - BOTH buttons must have the same size, same padding, same font weight, same border radius. Equal visual prominence means NO size differences, NO making reject look like a text link. Both are solid-colored buttons.
    - Layout: `flex flex-wrap gap-3` for button row
    - Both call the composable methods: acceptAll() and rejectAll()

    Match the site design: sage/waldhonig palette, rounded corners per CONTEXT.

    **CookieSettings.vue panel:**

    - Opened via `settingsOpen` from useCookieConsent
    - `v-if="settingsOpen"` with dark overlay backdrop
    - Centered modal or slide-up panel from bottom
    - Heading: "Cookie-Einstellungen" in Lora serif
    - Three categories displayed as toggle rows:

      1. "Notwendige Cookies" (essential) -- toggle visually present but disabled/always-on. Explain: "Diese Cookies sind fuer die Grundfunktionen der Website erforderlich und konnen nicht deaktiviert werden."
      2. "Buchung" (booking) -- toggle, off by default. Explain: "Ermoglicht die Einbindung des Beds24-Buchungswidgets fuer die direkte Zimmerbuchung."
      3. "Medien" (media) -- toggle, off by default. Explain: "Ermoglicht die Einbindung von YouTube-Videos und interaktiven Karten."

    - Each toggle: use a styled `<input type="checkbox">` or `<button role="switch">` with `aria-checked`
    - Toggle styling: sage-500 when on, sage-200 when off, rounded-full pill shape
    - "Auswahl speichern" button to save and close
    - "Alle akzeptieren" button as secondary option
    - Close button (X) in top-right corner
    - Use `useScrollLock` from @vueuse to lock body scroll when settings panel is open

    **Wire into layout and footer:**

    Update `app/layouts/default.vue` to include CookieConsent and CookieSettings:
    ```vue
    <template>
      <div class="flex min-h-screen flex-col">
        <AppHeader />
        <main class="flex-1 pt-20">
          <slot />
        </main>
        <AppFooter />
        <CookieConsent />
        <CookieSettings />
      </div>
    </template>
    ```

    Update `app/components/AppFooter.vue`: Wire the "Cookie-Einstellungen" button in Column 4 (Rechtliches) to call `useCookieConsent().openSettings()`. Change the placeholder button to:
    ```vue
    <button
      class="text-sage-300 hover:text-white transition-colors"
      @click="openSettings"
    >
      Cookie-Einstellungen
    </button>
    ```
    Import openSettings from the composable in the footer's setup.

  </action>
  <verify>
    Run `make dev` and test in browser:
    1. First visit (clear cookies): consent banner appears at bottom
    2. Both Accept and Reject buttons are same size and equally prominent
    3. Click "Nur Notwendige" -- banner disappears
    4. Reload page -- banner does NOT reappear
    5. Open DevTools > Application > Cookies: `cookie_consent` cookie exists with `{"essential":true,"booking":false,"media":false}`
    6. Click "Cookie-Einstellungen" in footer -- settings panel opens with 3 category toggles
    7. Essential toggle is on and disabled; Booking and Media toggles are off
    8. Toggle Booking on, click "Auswahl speichern" -- panel closes, cookie updates
    9. Open browser Network tab, reload: zero requests to any third-party domain
    10. Delete the cookie_consent cookie from DevTools, reload: banner reappears
    Run `make lint` -- passes.
    Run `make typecheck` -- passes.
  </verify>
  <done>
    Cookie consent banner shows on first visit with equal-prominence Accept/Reject buttons. Cookie persists 180 days. Footer Cookie-Einstellungen link opens category toggle panel. Essential is always on. No third-party requests before consent. Banner uses v-if (not v-show).
  </done>
</task>

<task type="auto">
  <name>Task 2: Three legal pages (Impressum, Datenschutz, AGB)</name>
  <files>
    app/pages/impressum.vue
    app/pages/datenschutz.vue
    app/pages/agb.vue
  </files>
  <action>
    Create three legal pages with complete German legal text. Each page uses the default layout (header + footer), Lora serif headings, DM Sans body text, max 70ch line length (prose-content class).

    All three pages should use `useSeoMeta` for page-specific meta tags (title, description, robots: 'noindex' for legal pages is optional but common).

    **impressum.vue -- Impressum per DDG Paragraph 5 (LEGL-01):**

    Page title: "Impressum" (H1, Lora Bold)
    Subtitle: "Angaben gemaess DDG Paragraph 5" (use proper umlaut)

    Content sections (use `<section>` elements with H2 headings):

    1. **Diensteanbieter / Angaben gemaess Paragraph 5 DDG:**
       - [INHABER_NAME] (placeholder -- from app.config.ts legal.ownerName)
       - Pension Volgenandt
       - Otto-Reuter-Strasse 28
       - 37327 Leinefelde-Worbis OT Breitenbach
       - Deutschland

    2. **Kontakt:**
       - Telefon: 03605 542775 (clickable tel: link)
       - Mobil: 0160 97719112 (clickable tel: link)
       - E-Mail: kontakt@pension-volgenandt.de (clickable mailto: link)

    3. **Umsatzsteuer-ID / Steuernummer:**
       - Umsatzsteuer-Identifikationsnummer gemaess Paragraph 27a UStG: [STEUERNUMMER_ODER_UST_IDNR] (placeholder)
       - OR: "Steuernummer: [STEUERNUMMER]" if no USt-IdNr

    4. **Verantwortlich fuer den Inhalt nach Paragraph 18 Abs. 2 MStV:**
       - [INHABER_NAME] (same as owner)
       - Address repeated

    5. **EU-Streitschlichtung:**
       - Standard text: "Die Europaische Kommission stellt eine Plattform zur Online-Streitbeilegung (OS) bereit: https://ec.europa.eu/consumers/odr/. Unsere E-Mail-Adresse finden Sie oben im Impressum."

    6. **Verbraucherstreitbeilegung / Universalschlichtungsstelle:**
       - "Wir sind nicht bereit oder verpflichtet, an Streitbeilegungsverfahren vor einer Verbraucherschlichtungsstelle teilzunehmen."

    Read contact details from `useAppConfig()`. Read legal placeholders from `useAppConfig().legal`.
    Use proper German umlauts throughout the legal text.

    **datenschutz.vue -- Datenschutzerklaerung per DSGVO (LEGL-02):**

    Page title: "Datenschutzerklaerung" (H1, proper umlaut)

    Comprehensive privacy policy. This must be thorough (it is a legal document). Include these sections with H2 headings:

    1. **Datenschutz auf einen Blick** -- overview of data collection
    2. **Allgemeine Hinweise und Pflichtinformationen** -- who is responsible (Verantwortliche Stelle), data from app.config
    3. **Hosting** -- mention static hosting (Netlify/Cloudflare Pages), server logs, legal basis Art. 6 Abs. 1 lit. f DSGVO
    4. **Ihre Rechte als betroffene Person** -- Art. 15-21 DSGVO rights: Auskunft, Berichtigung, Loeschung, Einschraenkung, Datenportabilitaet, Widerspruch, Beschwerde bei Aufsichtsbehoerde
    5. **Cookies und Einwilligungsverwaltung** -- Reference TDDDG Paragraph 25 (NOT TTDSG). Explain three categories: essential (session, consent cookie), booking (Beds24), media (YouTube, Maps). Explain consent mechanism (banner, equal-prominence buttons, revocable via footer)
    6. **Kontaktformular** -- data collected when contacting via form/email, legal basis Art. 6 Abs. 1 lit. b DSGVO
    7. **Buchungswidget (Beds24)** -- explain Beds24 data processing, only loaded with consent, purpose, legal basis Art. 6 Abs. 1 lit. a DSGVO. Note: "wird erst nach Ihrer Einwilligung geladen"
    8. **SSL- bzw. TLS-Verschluesselung** -- HTTPS encryption notice
    9. **Aenderung der Datenschutzerklaerung** -- reservation to update policy
    10. **Quellen** -- credit legal text sources if applicable

    Reference correct laws: DDG (not TMG), TDDDG Paragraph 25 (not TTDSG), DSGVO throughout.
    Include "Stand: Februar 2026" date stamp.

    **agb.vue -- Allgemeine Geschaeftsbedingungen (LEGL-03):**

    Page title: "Allgemeine Geschaeftsbedingungen" (H1, proper umlaut)
    Subtitle: "fuer die Pension Volgenandt, Breitenbach" (use proper umlaut)

    Standard German pension/Beherbergungsbetrieb AGB. Sections:

    1. **Geltungsbereich** -- These terms apply to all accommodation contracts with Pension Volgenandt
    2. **Vertragsschluss** -- Booking becomes binding upon written/electronic confirmation by pension
    3. **Leistungen** -- Scope of services (room, breakfast if included, facilities)
    4. **Preise und Zahlung** -- Prices include VAT, payment methods, when payment is due
    5. **Ruecktritt und Stornierung** -- Cancellation policy:
       - Bis 14 Tage vor Anreise: kostenfrei
       - 14-7 Tage vor Anreise: 50% des Gesamtpreises
       - 7-2 Tage vor Anreise: 80% des Gesamtpreises
       - Weniger als 2 Tage oder Nichtanreise: 100%
       - (These are standard German pension cancellation terms. Owner must review before launch.)
    6. **An- und Abreise** -- Check-in from 15:00, check-out by 11:00 (standard times, owner adjusts)
    7. **Haftung** -- Standard liability limitations, guest responsibility for damages
    8. **Hausordnung** -- Brief reference to house rules (quiet hours, smoking, pets policy noting dog fee from pricing)
    9. **Datenschutz** -- Brief reference to /datenschutz page
    10. **Schlussbestimmungen** -- German law applies, severability clause, Gerichtsstand

    Add "Stand: Februar 2026" and note: "Diese AGB wurden als Vorlage erstellt und muessen vor Veroeffentlichung vom Betreiber geprueft werden." (disclaimer that owner must review)

    **All three pages share these patterns:**
    - `useSeoMeta({ title: 'Impressum | Pension Volgenandt', description: '...' })`
    - Container: `mx-auto max-w-screen-xl px-4 py-12`
    - Content wrapper: `prose-content` class (max-width: 70ch per DSGN-05)
    - H1: `font-serif text-3xl font-bold text-sage-900 mb-6`
    - H2: `font-serif text-xl font-semibold text-sage-800 mt-8 mb-4`
    - Body text: `font-sans text-base text-sage-700 leading-relaxed` (inherits from base styles)
    - Links: `text-waldhonig-600 hover:text-waldhonig-700 underline`
    - Paragraphs: `mb-4`
    - Lists: `list-disc pl-6 mb-4 space-y-1`

  </action>
  <verify>
    Run `make dev` and test in browser:
    1. Navigate to /impressum/ -- page loads with complete Impressum text
    2. Impressum shows DDG Paragraph 5 reference (NOT TMG)
    3. Phone and email are clickable links
    4. Placeholder markers [INHABER_NAME] and [STEUERNUMMER] are visible (owner fills later)
    5. Navigate to /datenschutz/ -- comprehensive privacy policy with all sections
    6. Datenschutz references TDDDG Paragraph 25 (NOT TTDSG) and DSGVO
    7. Navigate to /agb/ -- complete booking terms with cancellation policy
    8. All three pages: Lora headings, DM Sans body, max 70ch width, proper umlauts
    9. All three pages accessible from footer Rechtliches column links
    10. Footer legal links (Impressum, Datenschutz, AGB) work correctly
    Run `make lint` -- passes.
    Run `make typecheck` -- passes.
    Run `make build` -- builds successfully (pages are pre-rendered via nitro.prerender).
  </verify>
  <done>
    Three complete legal pages render at /impressum/, /datenschutz/, /agb/ with correct German legal text citing DDG Paragraph 5 and TDDDG Paragraph 25. Owner placeholders are marked. Typography follows design system (Lora headings, DM Sans body, 70ch max width).
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Phase 1 delivery: Nuxt 4 project with Tailwind v4 design tokens, responsive layout (sticky header with compression + mobile hamburger, 4-column footer with CTA bar), cookie consent system (banner + settings panel), and three legal pages (Impressum, Datenschutz, AGB).
  </what-built>
  <how-to-verify>
    Start the dev server with `make dev` and test the following:

    **1. Layout & Header (desktop > 1024px):**
    - [ ] Sticky header with "Pension Volgenandt" text logo, 5 nav links, phone number, waldhonig CTA
    - [ ] Scroll down -- header compresses smoothly, never disappears
    - [ ] Phone number is clickable (tel: link)
    - [ ] CTA button says "Verfuegbarkeit pruefen" in waldhonig

    **2. Header (mobile < 1024px):**
    - [ ] Logo + CTA button visible in header bar
    - [ ] Hamburger button shows with "Menu" text label
    - [ ] Hamburger opens: 5 nav items, divider, phone, full-width CTA
    - [ ] Body scroll is locked when menu is open
    - [ ] Clicking a nav item closes the menu

    **3. Footer:**
    - [ ] Terracotta CTA bar above footer with "Bereit fuer Ihren Aufenthalt..." text
    - [ ] 4 columns: Brand, Kontakt, Entdecken, Rechtliches
    - [ ] Phone and email are clickable in Kontakt column
    - [ ] Mobile: Contact section appears before Brand section

    **4. Cookie Consent:**
    - [ ] Clear cookies, reload: consent banner appears at bottom
    - [ ] Two buttons of EQUAL size/prominence (waldhonig + sage)
    - [ ] Click "Nur Notwendige" -- banner disappears, does not return on reload
    - [ ] Click "Cookie-Einstellungen" in footer -- settings panel opens
    - [ ] Essential toggle is on and disabled; Booking and Media are off
    - [ ] Toggle Booking on, save -- cookie updates

    **5. Legal Pages:**
    - [ ] /impressum/ -- complete text with DDG Paragraph 5 reference, placeholder markers visible
    - [ ] /datenschutz/ -- comprehensive policy with TDDDG Paragraph 25 reference
    - [ ] /agb/ -- booking terms with cancellation tiers
    - [ ] All pages have Lora headings, DM Sans body, comfortable reading width

    **6. Typography & Design:**
    - [ ] Headings are Lora serif (warm, calligraphic feel)
    - [ ] Body text is DM Sans (clean, readable)
    - [ ] Colors match: sage greens, waldhonig CTAs, cream/warm-white backgrounds
    - [ ] Dark header/footer create the "warm frame" around light content

    **7. Tooling:**
    - [ ] `make build` completes without errors
    - [ ] `make lint` passes with 0 errors
    - [ ] Browser Network tab: zero requests to googleapis.com or external font CDNs

  </how-to-verify>
  <resume-signal>Type "approved" or describe specific issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. Cookie consent banner appears on first visit with equal-prominence buttons
2. After consent choice, banner does not reappear on reload (cookie persists)
3. Footer "Cookie-Einstellungen" opens settings panel with 3 category toggles
4. Browser Network tab shows zero third-party requests before consent
5. /impressum/ page: DDG Paragraph 5, complete contact info, placeholders for owner data
6. /datenschutz/ page: DSGVO rights, TDDDG Paragraph 25 cookie section, Beds24 mention
7. /agb/ page: booking terms, 4-tier cancellation policy, house rules reference
8. All legal pages accessible via footer links and render with correct typography
9. `make build` succeeds (pre-renders /impressum, /datenschutz, /agb)
10. `make lint` and `make typecheck` pass with 0 errors
</verification>

<success_criteria>

- Cookie consent composable persists state via useCookie (SSR-safe, 180-day expiry)
- Consent banner uses v-if (not v-show), has equal-prominence Accept/Reject buttons (TDDDG compliant)
- Cookie settings panel has three categories: essential (always on), booking, media
- All three legal pages contain complete German legal text with correct law references (DDG, TDDDG, DSGVO)
- Impressum has DDG Paragraph 5 required fields with owner placeholders
- Datenschutz covers all DSGVO rights, cookie categories, Beds24 consent mention
- AGB has standard pension booking terms with 4-tier cancellation policy
- All pages pre-render via nuxt generate (SSG compatible)
- Human verification confirms visual quality, legal text accuracy, and consent UX
  </success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-legal-compliance/01-03-SUMMARY.md`
</output>
