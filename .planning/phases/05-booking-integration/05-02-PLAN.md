---
phase: 05-booking-integration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/booking/BookingBar.vue
  - app/layouts/default.vue
autonomous: false

must_haves:
  truths:
    - 'Every page shows a BookingBar: sticky bottom bar on desktop with CTA, floating action button on mobile'
    - 'BookingBar is hidden when cookie consent banner is visible (first visit)'
    - 'On room detail pages, the BookingBar scrolls to the #buchung section; on other pages, it navigates to /zimmer/'
    - 'BookingBar z-index (30) is below cookie consent banner (50) and header (40)'
  artifacts:
    - path: 'app/components/booking/BookingBar.vue'
      provides: 'Site-wide sticky booking bar (desktop) and floating action button (mobile)'
      contains: 'hasConsented'
    - path: 'app/layouts/default.vue'
      provides: 'Default layout with BookingBar added'
      contains: 'BookingBar'
  key_links:
    - from: 'app/components/booking/BookingBar.vue'
      to: 'useCookieConsent'
      via: 'hasConsented to hide when consent banner is visible'
      pattern: 'hasConsented'
    - from: 'app/layouts/default.vue'
      to: 'app/components/booking/BookingBar.vue'
      via: 'component placed after CookieSettings in layout'
      pattern: 'BookingBar'
---

<objective>
Create the BookingBar component (sticky desktop bar / floating mobile button) and add it to the default layout so every page has quick booking access.

Purpose: Visitors on any page can immediately access booking -- the bar acts as a persistent conversion element. On room detail pages it scrolls to the embedded widget; on other pages it links to the rooms overview.
Output: New BookingBar component, updated default layout.
</objective>

<execution_context>
@C:\Users\bernt\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\bernt\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-booking-integration/05-RESEARCH.md

# Existing patterns

@app/layouts/default.vue
@app/components/CookieConsent.vue
@app/composables/useCookieConsent.ts
@app/components/AppHeader.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BookingBar component and add to layout</name>
  <files>
    app/components/booking/BookingBar.vue
    app/layouts/default.vue
  </files>
  <action>
    1. Create `app/components/booking/BookingBar.vue`:

       **Visibility logic:**
       - Use `useCookieConsent()` to get `hasConsented`
       - Only render the BookingBar when `hasConsented` is `true` (v-if). This prevents overlap with the CookieConsent banner at the bottom of the screen on first visit.
       - Use `z-30` (below consent banner z-50, below header z-40)

       **Route-aware behavior:**
       - Use `useRoute()` to detect if the current page is a room detail page: `route.path.startsWith('/zimmer/') && route.params.slug`
       - On room detail pages: the CTA scrolls to `#buchung` section (smooth scroll via `document.getElementById('buchung')?.scrollIntoView({ behavior: 'smooth' })`)
       - On all other pages: the CTA navigates to `/zimmer/` via NuxtLink

       **Desktop layout (hidden on mobile: `hidden md:flex`):**
       - Fixed bottom bar: `fixed bottom-0 inset-x-0 z-30`
       - Background: `bg-white/95 backdrop-blur-sm border-t border-sage-200 shadow-lg`
       - Content centered in max-w-screen-xl container, flex row, items-center, justify-between, py-3 px-6
       - Left side: text "Finden Sie Ihr perfektes Zimmer" in sage-700, font-medium
       - Right side: CTA button styled like primary BaseButton:
         - On room pages: `<button @click="scrollToBooking">Jetzt buchen</button>` with waldhonig-500 bg
         - On other pages: `<NuxtLink to="/zimmer/">Verfugbarkeit prufen</NuxtLink>` with waldhonig-500 bg
       - Button classes: `rounded-lg bg-waldhonig-500 px-6 py-3 font-semibold text-white hover:bg-waldhonig-600 transition-colors`

       **Mobile layout (hidden on desktop: `md:hidden`):**
       - Floating action button: `fixed bottom-6 right-6 z-30`
       - Round button: `size-14 rounded-full bg-waldhonig-500 text-white shadow-lg hover:bg-waldhonig-600 transition-colors flex items-center justify-center`
       - Icon: `<Icon name="ph:calendar-check-duotone" class="size-6" />`
       - Same route-aware behavior: scroll to #buchung on room pages, navigate to /zimmer/ on other pages
       - Add `aria-label="Verfugbarkeit prufen"` for accessibility
       - Ensure 48px+ touch target (size-14 = 56px, good)

       **Scroll-to-booking helper function:**
       ```typescript
       function scrollToBooking() {
         const el = document.getElementById('buchung')
         if (el) {
           el.scrollIntoView({ behavior: 'smooth' })
         }
       }
       ```

    2. Update `app/layouts/default.vue`:
       - Add `<BookingBar />` after `<CookieSettings />` (last element before closing `</div>`)
       - The BookingBar self-manages its visibility via hasConsented, so no props needed
       - Final layout order: AppHeader, main slot, AppFooter, CookieConsent, CookieSettings, BookingBar

  </action>
  <verify>
    - `pnpm run typecheck` passes with no new errors
    - `app/components/booking/BookingBar.vue` exists with desktop bar and mobile FAB
    - `app/layouts/default.vue` includes `<BookingBar />`
    - BookingBar uses `hasConsented` from useCookieConsent for visibility
    - BookingBar uses z-30 (below z-50 consent banner and z-40 header)
    - Route detection distinguishes room detail pages from other pages
  </verify>
  <done>
    BookingBar component renders on every page (after cookie consent is given), providing a sticky desktop bar and floating mobile button for quick booking access. On room detail pages it scrolls to the embedded widget; on other pages it links to the rooms overview.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete booking integration for Phase 5:
    - BookingWidget with consent-gated Beds24 iframe and iframeResizer
    - BookingConsentPlaceholder shown before consent
    - BookingBar (sticky desktop bar + mobile FAB) on every page
    - Room detail pages have booking section with scroll anchor

    IMPORTANT PRE-CHECK: Before visual verification, confirm the beds24RoomId values:
    - Ferienwohnungen (emils-kuhwiese, schoene-aussicht) use propid only -- these are correct
    - Pension rooms (balkonzimmer: 2, rosengarten: 3, wohlfuehl-appartement: 1, doppelzimmer: 4, einzelzimmer: 5) have PLACEHOLDER room IDs. These may need to be updated with actual Beds24 room IDs from the admin panel.

    ALSO: iframeResizer dynamic height requires the Beds24 child script to be configured in Beds24 admin (see RESEARCH.md "iframeResizer Setup Requirements" > "Child Page" section). Without this, the iframe will display but won't auto-resize.

  </what-built>
  <how-to-verify>
    1. Run `pnpm dev` and visit http://localhost:3000/zimmer/emils-kuhwiese/
    2. Verify: BookingConsentPlaceholder is shown (if booking consent not yet granted)
    3. Open Network tab, confirm ZERO requests to beds24.com
    4. Click "Buchungswidget laden" button
    5. Verify: Beds24 iframe loads with URL containing propid=257613 and lang=de
    6. Visit http://localhost:3000/zimmer/balkonzimmer/ -- iframe URL should have roomid=2
    7. Check BookingBar:
       - Desktop: sticky bar at bottom with "Jetzt buchen" button
       - Click "Jetzt buchen" -- should smooth-scroll to #buchung section
       - Mobile (resize to <768px): floating round button in bottom-right
    8. Visit http://localhost:3000/ (homepage):
       - BookingBar CTA should say "Verfugbarkeit prufen" and link to /zimmer/
    9. If cookie consent banner is visible (clear cookies): BookingBar should be HIDDEN
    10. Verify beds24RoomId mappings are correct or note which need updating
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. `pnpm run typecheck` passes
2. BookingBar visible on desktop (sticky bar) and mobile (FAB) after cookie consent
3. BookingBar hidden when cookie consent banner is visible
4. On room detail pages, BookingBar scrolls to #buchung section
5. On other pages, BookingBar links to /zimmer/
6. No visual overlap between BookingBar and CookieConsent banner
</verification>

<success_criteria>

- BookingBar renders on every page with route-aware behavior
- Desktop: sticky bottom bar with CTA
- Mobile: floating action button with calendar icon
- Hidden when consent banner is showing (z-index and v-if both correct)
- Smooth scroll to #buchung on room detail pages works
  </success_criteria>

<output>
After completion, create `.planning/phases/05-booking-integration/05-02-SUMMARY.md`
</output>
